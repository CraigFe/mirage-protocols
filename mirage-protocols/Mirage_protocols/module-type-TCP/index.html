<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>TCP (mirage-protocols.Mirage_protocols.TCP)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">mirage-protocols</a></span></nav><header><h1><span class="keyword">Module type</span> <span class="module-path">Mirage_protocols.TCP</span></h1></header><div class="doc"><p>A TCP stack that can send and receive reliable streams using the
TCP protocol.</p></div><div class="spec type" id="type-error#row"><a href="#type-error#row" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>error#row</code><code></code><code></code></div><div class="doc"><p>The type for TCP errors.</p></div></div><div class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>error</code><span class="keyword"> = </span><span class="keyword">private </span><code>[&gt; </code><table class="variant"><tr id="type-error.Tcp.error" class="anchored"><td class="def type"><a href="#type-error.Tcp.error" class="anchor"></a><code><span class="keyword">| </span></code><code><a href="../Tcp/index.html#type-error">Tcp.error</a></code></td></tr></table><code> ]</code><code></code></div><div class="doc"><p>The type for TCP errors.</p></div></div><div class="spec type" id="type-write_error#row"><a href="#type-write_error#row" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>write_error#row</code><code></code><code></code></div><div class="doc"><p>The type for TCP write errors.</p></div></div><div class="spec type" id="type-write_error"><a href="#type-write_error" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>write_error</code><span class="keyword"> = </span><span class="keyword">private </span><code>[&gt; </code><table class="variant"><tr id="type-write_error.Tcp.write_error" class="anchored"><td class="def type"><a href="#type-write_error.Tcp.write_error" class="anchor"></a><code><span class="keyword">| </span></code><code><a href="../Tcp/index.html#type-write_error">Tcp.write_error</a></code></td></tr></table><code> ]</code><code></code></div><div class="doc"><p>The type for TCP write errors.</p></div></div><div class="spec type" id="type-buffer"><a href="#type-buffer" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>buffer</code><code></code><code></code></div><div class="doc"><p>The type for memory buffers.</p></div></div><div class="spec type" id="type-ipaddr"><a href="#type-ipaddr" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>ipaddr</code><code></code><code></code></div><div class="doc"><p>The type for IP address representations.</p></div></div><div class="spec type" id="type-ipinput"><a href="#type-ipinput" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>ipinput</code><code></code><code></code></div><div class="doc"><p>The type for input function continuation to pass onto the
underlying <a href="../module-type-IP/index.html">IP</a> stack. This will normally be a NOOP for a
conventional kernel, but a direct implementation will parse the
buffer.</p></div></div><div class="spec type" id="type-flow"><a href="#type-flow" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>flow</code><code></code><code></code></div><div class="doc"><p>A flow represents the state of a single TCPv4 stream that is connected
to an endpoint.</p></div></div><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span>Mirage_device.S</code></span></summary><div class="spec type" id="type-io"><a href="#type-io" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>+'a io</code><code></code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-disconnect"><a href="#val-disconnect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>disconnect : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> unit <a href="index.html#type-io">io</a></code></div><div class="doc"></div></div></details></div><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span>Mirage_flow.S<span class="keyword"> with </span><span class="keyword">type </span>'a <a href="../index.html#module-type-TCP">TCP</a>.io := <span class="type-var">'a</span> <a href="index.html#type-io">io</a><span class="keyword"> and </span><span class="keyword">type </span><a href="../index.html#module-type-TCP">TCP</a>.buffer := <a href="index.html#type-buffer">buffer</a><span class="keyword"> and </span><span class="keyword">type </span><a href="../index.html#module-type-TCP">TCP</a>.flow := <a href="index.html#type-flow">flow</a><span class="keyword"> and </span><span class="keyword">type </span><a href="../index.html#module-type-TCP">TCP</a>.error := <a href="index.html#type-error">error</a><span class="keyword"> and </span><span class="keyword">type </span><a href="../index.html#module-type-TCP">TCP</a>.write_error := <a href="index.html#type-write_error">write_error</a></code></span></summary><div class="spec val" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp_error : <a href="index.html#type-error">error</a> Fmt.t</code></div><div class="doc"></div></div><div class="spec val" id="val-pp_write_error"><a href="#val-pp_write_error" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp_write_error : <a href="index.html#type-write_error">write_error</a> Fmt.t</code></div><div class="doc"></div></div><div class="spec val" id="val-read"><a href="#val-read" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>read : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-buffer">buffer</a> Mirage_flow.or_eof, <a href="index.html#type-error">error</a>) Pervasives.result <a href="index.html#type-io">io</a></code></div><div class="doc"></div></div><div class="spec val" id="val-write"><a href="#val-write" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>write : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-buffer">buffer</a> <span class="keyword">&#8209;&gt;</span> (unit, <a href="index.html#type-write_error">write_error</a>) Pervasives.result <a href="index.html#type-io">io</a></code></div><div class="doc"></div></div><div class="spec val" id="val-writev"><a href="#val-writev" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>writev : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-buffer">buffer</a> list <span class="keyword">&#8209;&gt;</span> (unit, <a href="index.html#type-write_error">write_error</a>) Pervasives.result <a href="index.html#type-io">io</a></code></div><div class="doc"></div></div><div class="spec val" id="val-close"><a href="#val-close" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>close : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> unit <a href="index.html#type-io">io</a></code></div><div class="doc"></div></div></details></div><div class="spec val" id="val-dst"><a href="#val-dst" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dst : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-ipaddr">ipaddr</a><span class="keyword"> * </span>int</code></div><div class="doc"><p>Get the destination IPv4 address and destination port that a
flow is currently connected to.</p></div></div><div class="spec val" id="val-write_nodelay"><a href="#val-write_nodelay" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>write_nodelay : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-buffer">buffer</a> <span class="keyword">&#8209;&gt;</span> (unit, <a href="index.html#type-write_error">write_error</a>) Pervasives.result <a href="index.html#type-io">io</a></code></div><div class="doc"><p><code class="code">write_nodelay flow buffer</code> writes the contents of <code class="code">buffer</code>
to the flow. The thread blocks until all data has been successfully
transmitted to the remote endpoint.
Buffering within the stack is minimized in this mode.
Note that this API will change in a future revision to be a
per-flow attribute instead of a separately exposed function.</p></div></div><div class="spec val" id="val-writev_nodelay"><a href="#val-writev_nodelay" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>writev_nodelay : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-buffer">buffer</a> list <span class="keyword">&#8209;&gt;</span> (unit, <a href="index.html#type-write_error">write_error</a>) Pervasives.result <a href="index.html#type-io">io</a></code></div><div class="doc"><p><code class="code">writev_nodelay flow buffers</code> writes the contents of <code class="code">buffers</code>
to the flow. The thread blocks until all data has been successfully
transmitted to the remote endpoint.
Buffering within the stack is minimized in this mode.
Note that this API will change in a future revision to be a
per-flow attribute instead of a separately exposed function.</p></div></div><div class="spec val" id="val-create_connection"><a href="#val-create_connection" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>create_connection : ?&#8288;keepalive:<a href="../Keepalive/index.html#type-t">Keepalive.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-ipaddr">ipaddr</a><span class="keyword"> * </span>int) <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-flow">flow</a>, <a href="index.html#type-error">error</a>) Pervasives.result <a href="index.html#type-io">io</a></code></div><div class="doc"><p><code class="code">create_connection ~keepalive t (addr,port)</code> opens a TCPv4 connection
to the specified endpoint.</p><p>If the optional argument <code class="code">?keepalive</code> is provided then TCP keep-alive
messages will be sent to the server when the connection is idle. If
no responses are received then eventually the connection will be disconnected:
<code class="code">read</code> will return <code class="code">Ok `Eof</code> and write will return <code class="code">Error `Closed</code></p></div></div><div class="spec type" id="type-listener"><a href="#type-listener" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>listener</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-listener.process" class="anchored"><td class="def field"><a href="#type-listener.process" class="anchor"></a><code>process : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> unit <a href="index.html#type-io">io</a>;</code></td><td class="doc"><p>(** process a connected flow *)</p></td></tr><tr id="type-listener.keepalive" class="anchored"><td class="def field"><a href="#type-listener.keepalive" class="anchor"></a><code>keepalive : <a href="../Keepalive/index.html#type-t">Keepalive.t</a> option;</code></td><td class="doc"><p>(** optional TCP keepalive configuration *)</p></td></tr></table><code>}</code><code></code></div><div class="doc"><p>A TCP listener on a particular port</p></div></div><div class="spec val" id="val-input"><a href="#val-input" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> listeners:(int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-listener">listener</a> option) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-ipinput">ipinput</a></code></div><div class="doc"><p><code class="code">input t listeners</code> returns an input function continuation to be
passed to the underlying <a href="../module-type-IP/index.html">IP</a> stack.</p><p>When the stack receives a TCP SYN (i.e. a connection request) to a
particular <code class="code">port</code>, it will evaluate <code class="code">listeners port</code>:</p><ul><li>If <code class="code">listeners port</code> is <code class="code">None</code>, the input function will return an RST
to refuse the connection.</li><li>If <code class="code">listeners port</code> is <code class="code">Some listener</code> then the connection will be
accepted and the resulting flow will be processed by <code class="code">listener.process</code>.
If <code class="code">listener.keepalive</code> is <code class="code">Some configuration</code> then the TCP keep-alive
<code class="code">configuration</code> will be applied before calling <code class="code">listener.process</code>.</li></ul></div></div></body></html>